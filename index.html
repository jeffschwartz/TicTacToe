<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Tic Tac Toe</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="">
        <meta name="author" content="">

        <!-- Le styles -->
        <link href="libs/bootstrap/css/bootstrap.css" rel="stylesheet">
        <style type="text/css">
            body {
                padding-top: 60px;
                padding-bottom: 40px;
            }
        </style>
        <link href="libs/bootstrap/css/bootstrap-responsive.css" rel="stylesheet">

        <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <!-- My less style sheet -->
        <link rel="stylesheet/less" type="text/css" href="css/tictactoe.less">
        <script src="js/less-1.3.0.min.js" type="text/javascript"></script>

        <!-- Le fav and touch icons -->
        <link rel="shortcut icon" href="libs/bootstrap/ico/favicon.ico">
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="libs/bootstrap/ico/apple-touch-icon-144-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="libs/bootstrap/ico/apple-touch-icon-114-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="libs/bootstrap/ico/apple-touch-icon-72-precomposed.png">
        <link rel="apple-touch-icon-precomposed" href="libs/bootstrap/ico/apple-touch-icon-57-precomposed.png">
    </head>

    <body>

        <div class="navbar navbar-inverse navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="#">Project name</a>

                    <div class="nav-collapse collapse">
                        <ul class="nav">
                            <li class="active"><a href="#">Home</a></li>
                            <li><a href="#about">About</a></li>
                            <li><a href="#contact">Contact</a></li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    <li><a href="#">Action</a></li>
                                    <li><a href="#">Another action</a></li>
                                    <li><a href="#">Something else here</a></li>
                                    <li class="divider"></li>
                                    <li class="nav-header">Nav header</li>
                                    <li><a href="#">Separated link</a></li>
                                    <li><a href="#">One more separated link</a></li>
                                </ul>
                            </li>
                        </ul>
                        <form class="navbar-form pull-right">
                            <input class="span2" type="text" placeholder="Email">
                            <input class="span2" type="password" placeholder="Password">
                            <button type="submit" class="btn">Sign in</button>
                        </form>
                    </div>
                    <!--/.nav-collapse -->
                </div>
            </div>
        </div>

        <div class="container">

            <!-- Main hero unit for a primary marketing message or call to action -->
            <div class="hero-unit">
                <h1>Lets Play Tic Tac Toe!</h1>

                <p>This is a template for a simple marketing or informational website. It includes a large callout called the hero
                    unit and three supporting pieces of content. Use it as a starting point to create something more unique.</p>

                <p><a id="begingame" class="btn btn-primary btn-large">Begin New Game &raquo;</a></p>
            </div>

            <!-- The thinking heads and game board container -->
            <div>

                <!-- The thinking heads container -->
                <div class="row" style="margin-bottom: 25px;">
                    <div id="humanavatar" class="span5" style="visibility: hidden;">
                        <img src="img/humanavatar.jpg" alt="human avatar"><span class="avatarspeak">Your turn!</span>
                    </div>
                    <div id="computeravatar" class="span5 offset2" style="visibility: hidden; text-align: right;">
                        <span class="avatarspeak">Computer's turn!</span><img src="img/computeravatar.jpeg" alt="computer avatar">
                    </div>
                </div>

                <!-- The game board -->
                <div class="row">
                    <div class="span4" style="text-align: center;">
                        <div class="square" style="border-right: solid 1px #444;">&nbsp;</div>
                    </div>
                    <div class="span4" style="text-align: center;">
                        <div class="square">&nbsp;</div>
                    </div>
                    <div class="span4" style="text-align: center;">
                        <div class="square" style="border-left: solid 1px #444;">&nbsp;</div>
                    </div>
                </div>
                <div class="row" style="border-top: solid 1px #444; border-bottom: solid 1px #444;">
                    <div class="span4" style="text-align: center;">
                        <div class="square" style="border-right: solid 1px #444;">&nbsp;</div>
                    </div>
                    <div class="span4" style="text-align: center;">
                        <div class="square">&nbsp;</div>
                    </div>
                    <div class="span4" style="text-align: center;">
                        <div class="square" style="border-left: solid 1px #444;">&nbsp;</div>
                    </div>
                </div>
                <div class="row">
                    <div class="span4" style="text-align: center;">
                        <div class="square" style="border-right: solid 1px #444;">&nbsp;</div>
                    </div>
                    <div class="span4" style="text-align: center;">
                        <div class="square">&nbsp;</div>
                    </div>
                    <div class="span4" style="text-align: center;">
                        <div class="square" style="border-left: solid 1px #444;">&nbsp;</div>
                    </div>
                </div>
            </div>
            <hr>

            <footer>
                <p>&copy; Tic Tac Toe Company 2012</p>
            </footer>

        </div>
        <!-- /container -->

        <!-- Le javascript
        ================================================== -->
        <!-- Placed at the end of the document so the pages load faster -->
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script>

            "use strict";





            $ ( function () {

                var movesCount = 0;
                var $humanAvatar = $ ( '#humanavatar' );
                var $computerAvatar = $ ( '#computeravatar' );
                var board = $ ( 'div.square' ).toArray ();




                var getSquarePiece = function ( row, col ) {
                    return $ ( board[row * 3 + col] ).html ();
                };





                var getSquarePieceValue = function ( row, col ) {
                    var piece = getSquarePiece ( row, col );
                    return  piece === '&nbsp;' ? 0 : piece === 'O' ? 1 : 4;
                };



                var getSquare = function(row, col){
                   return board[row * 3 + col];
                };


                /*
                 * finds either a blocking or a winning square.
                 * looks for any row which has a value of rowSum, because
                 * the open square in that row is either the winning or
                 * blocking square.
                 */
                var findRowWithSum = function ( rowSum ) {
                    var sum;
                    var row;
                    var col;
                    var empty;

                    // sum all rows
                    for ( row = 0; row < 3; row++ ) {
                        sum = 0;
                        for ( col = 0; col < 3; col++ ) {
                            if ( getSquarePiece ( row, col ) === '&nbsp;' ) {
                                empty = [row, col];
                            }
                            sum += getSquarePieceValue ( row, col );
                        }
                        if ( sum === rowSum ) {
                            return empty;
                        }
                    }

                    // sum all cols 
                    for ( col = 0; col < 3; col++ ) {
                        sum = 0;
                        for ( row = 0; row < 3; row++ ) {
                            if ( getSquarePiece ( row, col ) === '&nbsp;' ) {
                                empty = [row, col];
                            }
                            sum += getSquarePieceValue ( row, col );
                        }
                        if ( sum === rowSum ) {
                            return empty;
                        }
                    }

                    // sum 2 diagonals
                    for ( row = 0; row < 3; row++ ) {
                        if ( getSquarePiece ( row, row ) === '&nbsp;' ) {
                            empty = [row, row];
                        }
                        sum += getSquarePieceValue ( row, row );
                    }
                    if ( sum === rowSum ) {
                        return empty;
                    }

                    for ( row = 0; row < 3; row++ ) {
                        if ( getSquarePiece ( row, 2 - row ) === '&nbsp;' ) {
                            empty = [row, row];
                        }
                        sum += getSquarePieceValue ( row, 2 - row );
                    }
                    if ( sum === rowSum ) {
                        return empty;
                    }

                    return null;
                };






                var findRandomOpenSquare = function () {
                    var keepSearching = true;
                    var square;
                    var num;
                    var text;

                    while ( keepSearching === true ) {
                        num = Math.floor ( (Math.random () * 9) + 1 );
                        square = board[num - 1];
                        text = $ ( square ).html ();

                        if ( text === '&nbsp;' ) {
                            keepSearching = false;
                        }
                    }
                    return square;

                };







                /*
                 * do something when visiting each square
                 */
                var visitEachSquare = function ( $squares, cb ) {

                    // call callback function passing index & Element as parameters
                    $squares.each ( function ( index, Element ) {
                        cb ( index, Element );
                    } );

                };







                /*
                 * Clear the game board without animation
                 */
                var clearBoard = function () {
                    visitEachSquare ( $ ( 'div.square' ), function ( index, Element ) {
                        $ ( Element ).html ( '&nbsp;' );
                        $ ( Element ).unbind ( 'click' );
                    } );
                };






                /*
                 * Generate the game board with animation. Fills the board with
                 * Xs & Os every 25 miliseconds and then waits 1 second.
                 */
                var fillTheBoard = function ( cb ) {
                    var toDos = [];
                    var $squares = $ ( 'div.square' );

                    visitEachSquare ( $squares, function ( index, Element ) {
                        var row = Math.floor ( index / 3 );
                        console.log ( row );

                        var col = index % 3;
                        console.log ( col );

                        var player = index % 2 === 0 ? 'X' : 'O';
                        toDos.push ( {player : player, Element : Element} );

                        if ( toDos.length === 9 ) {

                            // show the 1st square immediately
                            $ ( toDos[0].Element ).css ( 'display', 'none' ).
                                    text ( toDos[0].player ).css ( 'color', toDos[0].player === 'X' ? '#8800ff' : '#000' ).fadeIn ( 'slow' );

                            // increment the index
                            var i = 1;

                            // show the remaining squares 250 milliseconds apart
                            var timer = setInterval ( function () {

                                // if this is the last toDo shut down the interval
                                if ( i > 8 ) {

                                    // shut down the timer loop
                                    clearInterval ( timer );

                                    setTimeout ( function () {
                                        cb ();
                                    }, 1000 );

                                } else {

                                    // get the next toDo
                                    var toDo = toDos[i];

                                    $ ( toDo.Element ).css ( 'display', 'none' ).
                                            text ( toDo.player ).
                                            css ( 'color', toDo.player === 'X' ? '#8800ff' : '#000' ).
                                            fadeIn ( 'slow' );

                                    // set up the next iteration of the loop
                                    i += 1;

                                }

                            }, 250 );

                        }

                    } );
                };






                $ ( document ).on ( 'show_computer_avatar', function ( eventObject ) {
                    $computerAvatar.css ( 'visibility', 'visible' );
                    $humanAvatar.css ( 'visibility', 'hidden' );
                } );






                $ ( document ).on ( 'show_human_avatar', function ( eventObject ) {
                    $computerAvatar.css ( 'visibility', 'hidden' );
                    $humanAvatar.css ( 'visibility', ' visible' );
                } );






                /*
                 * Plays the game
                 */
                var play = function () {
                    var $squares = $ ( 'div.square' );

                    clearBoard ();

                    $ ( document ).triggerHandler ( 'computers_turn' );

                };






                /*
                 * Event type computer_turn handler
                 */
                $ ( document ).on ( 'computers_turn', function () {
                    var square;
                    var num;
                    var keepSearching;
                    var winingSquare;
                    var blockingSquare;

                    $ ( document ).triggerHandler ( 'show_computer_avatar' );
                    // if this is the 1st move then take center square ha ha ha ...
                    if ( movesCount === 0 ) {
                        $ ( board[4] ).html ( 'X' );
                    } else {

                        /*
                         * finds a winning move if there is one mathematically.
                         * since computer pieces each have a value of 4, any row
                         * whose value is 8 (4 x 2) is a candidate for a winning move.
                         * very simple, actually.
                         */
                        winingSquare = findRowWithSum ( 8 );
                        if ( winingSquare ) {
                            square = getSquare ( winingSquare[0], winingSquare[1] );
                            $ ( square ).text ( 'X' ).css ( 'color', '#8800ff' ).css ( 'cursor', 'auto' );
                        }

                        /*
                         * finds a blocking move if there is one mathematically.
                         * since Os (human player' piece) is = to 1, any row with a value of 2 ( O x 2)
                         * has a square that can be used to block. very simple, actually.
                         */
                        blockingSquare = findRowWithSum ( 2 );
                        if ( blockingSquare ) {
                            square = getSquare ( blockingSquare[0], blockingSquare[1] );
                            $ ( square ).text ( 'X' ).css ( 'color', '#8800ff' ).css ( 'cursor', 'auto' );
                        }

                        /*
                         * there is no winning or blocking move so the
                         * computer will chose its square randomly.
                         */
                        square = findRandomOpenSquare ();
                        $ ( square ).text ( 'X' ).css ( 'color', '#8800ff' ).css ( 'cursor', 'auto' );

                    }

                    movesCount += 1;

                    // just a little bit of latency so the computer talking head can be seen
                    setTimeout ( function () {
                        if ( checkForWin (12) === false ) {
                            $ ( document ).triggerHandler ( 'humans_turn' );
                        } else {
                            alert ( 'The Computer Won!\nThe Computer Won! Ha Ha LOL!!!!' );
                        }
                    }, 1000 );

                } );







                $ ( document ).on ( 'disable_the_board', function () {
                    visitEachSquare ( $ ( 'div.square' ), function ( index, Element ) {
                        $ ( Element ).unbind ( 'click' ).css ( 'cursor', 'auto' );
                    } );

                } );








                /*
                 * checks for a winning move by either human or computer
                 */
                var checkForWin = function (winingValue) {
                    var row = 0;
                    var col = 0;
                    var sum = 0;
                    var board = $ ( 'div.square' ).toArray ();

                    if ( movesCount >= 5 ) {
                        // check horizontal rows
                        for ( row = 0; row < 3; row++ ) {
                            sum = 0;
                            for ( col = 0; col < 3; col++ ) {
                                sum += getSquarePieceValue ( row, col );
                            }

                            if ( sum === winingValue ) {
                                return true;
                            }
                        }

                        // check vertical rows
                        for ( col = 0; col < 3; col++ ) {
                            sum = 0;
                            for ( row = 0; row < 3; row++ ) {
                                sum += getSquarePieceValue ( row, col );
                            }

                            if ( sum === winingValue ) {
                                return true;
                            }
                        }

                        // check diagonal rows
                        for ( row = 0; row < 3; row++ ) {
                            sum += getSquarePieceValue ( row, row );
                        }
                        if ( sum === winingValue ) {
                            return true;
                        }

                        for ( row = 0; row < 3; row++ ) {
                            sum += getSquarePieceValue ( row, 2 - row );
                        }
                        if ( sum === winingValue ) {
                            return true;
                        }

                    }
                    return false;
                };







                var humanClickHandler = function ( event, Element ) {
                    // mark the board
                    $ ( Element ).text ( 'O' ).css ( 'color', '#000' ).
                            css ( 'cursor', 'auto' ).unbind ( 'click' );

                    movesCount += 1;

                    // disable the board
                    $ ( document ).triggerHandler ( 'disable_the_board' );

                    // check for win
                    if ( checkForWin (3) === false ) {
                        $ ( document ).triggerHandler ( 'computers_turn' );
                    } else {
                        alert ( 'There Is A Winner!' );
                    }

                };






                $ ( document ).on ( 'enable_the_board', function () {
                    visitEachSquare ( $ ( 'div.square' ), function ( index, Element ) {
                        if ( $ ( Element ).html () === '&nbsp;' ) {
                            $ ( Element ).click (function ( event ) {
                                humanClickHandler ( event, Element );
                            } ).css ( 'cursor', 'pointer' );
                        }
                    } )
                } );






                /*
                 * Event type humans_turn handler
                 */
                $ ( document ).on ( 'humans_turn', function () {
                    $ ( document ).triggerHandler ( 'show_human_avatar' );
                    $ ( document ).triggerHandler ( 'enable_the_board' );
                } );







                /*
                 * initializes the game when page renders
                 * and when user clicks Begin New Game button
                 */
                var startGame = function () {
                    clearBoard ();
                    fillTheBoard ( function () {
                        play ();
                    } );
                };






                /*
                 * event handler for Begin New Game button click event
                 */
                $ ( '#begingame' ).click ( function ( event ) {
                    movesCount = 0;
                    // hide avatars
                    $humanAvatar.css ( 'visibility', 'hidden' );
                    $computerAvatar.css ( 'visibility', 'hidden' );
                    startGame ();
                } );






                /*
                 * handles page load and user refreshing the page
                 */
                startGame ();

            } );
        </script>

    </body>
</html>
